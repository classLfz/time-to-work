(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"152":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var n,r=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),o=a(6),l=_interopRequireDefault(o),i=_interopRequireDefault(a(0)),s=a(31),c=a(158),u=a(32),f=_interopRequireDefault(a(179)),d=_interopRequireDefault(a(163)),m=a(173),p=a(157);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}a(238),t.default=(0,u.connect)(function(e){return{"team":e.team,"staff":e.staff}},function(e){return{"onUpdateTeamMap":function onUpdateTeamMap(t){e((0,m.updateTeamMap)(t))}}})(n=function(e){function TeamEdit(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TeamEdit);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(TeamEdit.__proto__||Object.getPrototypeOf(TeamEdit)).call(this,e));return t.config={"navigationBarTitleText":"编辑团队","navigationBarBackgroundColor":"#00897B","navigationBarTextStyle":"white"},t.showAddJob=function(){t.setState({"addJob":!0})},t.handleJobChange=function(e){var a=JSON.parse(JSON.stringify(t.state.teamData));e.deleteKey&&delete a.jobs[e.deleteKey],e.oldName&&delete a.jobs[e.oldName],e.jobName&&e.jobData&&(delete a.jobs[e.jobName],a.jobs[e.jobName]=e.jobData),t.setState({"teamData":a})},t.addJob=function(e){var a=e.detail.value||"";if(a){var n=JSON.parse(JSON.stringify(t.state.teamData));n.jobs[a]={"num":1,"rest":!1,"workers":[]},t.setState({"teamData":{}}),setTimeout(function(){t.setState({"teamData":n})},100)}t.setState({"addJob":!1})},t.needLeaderChange=function(){var e=JSON.parse(JSON.stringify(t.state.teamData));e.needLeader=!e.needLeader,t.setState({"teamData":e})},t.handleLeaderPick=function(e){t.setState({"leaderSelected":e.detail.value})},t.submit=function(e){var a=e.detail.value,n=JSON.parse(JSON.stringify(t.props.team.teamMap));a.name!==t.state.teamName&&delete n[t.state.teamName],n[a.name]={"name":a.name,"rest":!a.rest,"needLeader":a.needLeader,"leaderWork":a.leaderWork,"leader":t.state.staffNameList[t.state.leaderSelected],"jobs":t.state.teamData.jobs,"workers":{}},n[a.name].needLeader||(n[a.name].leader=""),t.props.onUpdateTeamMap(n),l.default.navigateBack({"delta":1})},t.delete=function(){l.default.showModal({"title":"操作不可逆","content":"确定要删除该团队吗？","success":function success(e){if(e.confirm){var a=t.state.originalTeamName,n=JSON.parse(JSON.stringify(t.props.team.teamMap));delete n[a],t.props.onUpdateTeamMap(n),l.default.navigateBack({"delta":1})}}})},t.state={"originalTeamName":"","teamName":"","teamData":{},"staffNameList":[],"leaderWork":!0,"leaderSelected":0,"addJob":!1},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(TeamEdit,o.Component),r(TeamEdit,[{"key":"componentWillMount","value":function componentWillMount(){var e=this.props.staff.staffMap||{},t=this.$router.params.teamName||"",a=this.props.team.teamMap[t],n=a.leaderWork,r=a.leader,o=Object.keys(e);this.setState({"originalTeamName":t,"teamName":t,"teamData":a,"staffNameList":o,"leaderWork":n,"leaderSelected":o.indexOf(r)})}},{"key":"render","value":function render(){var e=this,t=this.state.staffNameList||[],a=null,n=null;this.state.teamData.needLeader?(a=t[this.state.leaderSelected]||"",n=i.default.createElement(s.View,null,i.default.createElement(s.View,{"className":"form-item"},i.default.createElement(s.Text,{"className":"title"},"负责人参与岗位分配"),i.default.createElement(s.Switch,{"name":"leaderWork","checked":this.state.leaderWork})),i.default.createElement(s.Picker,{"mode":"selector","range":t,"onChange":this.handleLeaderPick},i.default.createElement(s.View,{"className":"form-item"},i.default.createElement(s.Text,{"className":"title"},"负责人"),i.default.createElement(s.Text,{"className":"content"},a))))):(a="",n="");var r=this.state.teamData||{},o=r.jobs||{},l=this.props.staff,u=Object.keys(o).sort(p.naturalSort).map(function(t){return i.default.createElement(f.default,{"key":t,"jobName":t,"jobData":o[t],"staff":l,"onJobChange":e.handleJobChange})}),m=null;m=this.state.addJob?i.default.createElement(s.View,{"className":"add-job-container"},i.default.createElement(s.Text,null,"新建岗位名称"),i.default.createElement(s.Input,{"className":"item-input","placeholder":"请输入名称","autoFocus":!0,"onBlur":this.addJob})):"";return i.default.createElement(s.View,{"className":"form-container"},i.default.createElement(d.default,{"title":"编辑团队信息"}),i.default.createElement(s.Form,{"onSubmit":this.submit},i.default.createElement(s.View,{"className":"form-item"},i.default.createElement(s.Text,{"className":"title"},"团队名称"),i.default.createElement(s.Input,{"className":"item-input","name":"name","value":r.name,"placeholder":"请输入团队名称","autoFocus":!0})),i.default.createElement(s.View,{"className":"form-item"},i.default.createElement(s.Text,{"className":"title"},"是否需要负责人"),i.default.createElement(s.Switch,{"name":"needLeader","checked":r.needLeader,"onChange":this.needLeaderChange})),n,i.default.createElement(s.View,{"className":"form-item"},i.default.createElement(s.Text,{"className":"title"},"是否参与分配"),i.default.createElement(s.Switch,{"name":"rest","checked":!r.rest})),i.default.createElement(s.View,{"className":"job-list"},i.default.createElement(s.View,{"className":"title"},i.default.createElement(s.Text,null,"岗位列表"),i.default.createElement(s.View,{"className":"icon-btn","onClick":this.showAddJob},i.default.createElement(c.AtIcon,{"value":"add-circle","size":"24","color":"#19be6b"}))),m,u),i.default.createElement(s.View,{"className":"form-btns"},i.default.createElement(s.Button,{"type":"warn","className":"form-btn","onClick":this.delete},"删除"),i.default.createElement(s.Button,{"type":"primary","formType":"submit","className":"form-btn"},"提交"))))}},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentDidShow","value":function componentDidShow(){}}]),TeamEdit}())||n},"157":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.naturalSort=function naturalSort(e,t){var a,n,r=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,o=/^\s+|\s+$/g,l=/\s+/g,s=/^0x[0-9a-f]+$/i,c=/^0/,u=function i(e){return(naturalSort.insensitive&&(""+e).toLowerCase()||""+e).replace(o,"")},f=u(e),d=u(t),m=f.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=d.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(f.match(s),16)||1!==m.length&&Date.parse(f),b=parseInt(d.match(s),16)||h&&d.match(/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/)&&Date.parse(d)||null,N=function normChunk(e,t){return(!e.match(c)||1==t)&&parseFloat(e)||e.replace(l," ").replace(o,"")||0};if(b){if(h<b)return-1;if(h>b)return 1}for(var k=0,w=m.length,g=p.length,y=Math.max(w,g);k<y;k++){if(a=N(m[k]||"",w),n=N(p[k]||"",g),isNaN(a)!==isNaN(n))return isNaN(a)?1:-1;if(/[^\x00-\x80]/.test(a+n)&&a.localeCompare){var v=a.localeCompare(n);return v/Math.abs(v)}if(a<n)return-1;if(a>n)return 1}},t.formatTime=function formatTime(e){if(!e)return"";var t=new Date(e);if(!t)return"";var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),l=t.getHours(),i=t.getMinutes(),s=t.getSeconds();return[a,r,o].map(n).join("-")+" "+[l,i,s].map(n).join(":")};var n=function formatNumber(e){return(e=e.toString())[1]?e:"0"+e}},"162":function(e,t,a){},"163":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var n=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),r=a(6),o=_interopRequireDefault(r),l=_interopRequireDefault(a(0)),i=a(31),s=a(158);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}a(162);var c=function(e){function NavHeader(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,NavHeader);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(NavHeader.__proto__||Object.getPrototypeOf(NavHeader)).call(this,e));return t.back=function(){o.default.navigateBack({"delta":1})},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(NavHeader,r.Component),n(NavHeader,[{"key":"render","value":function render(){return l.default.createElement(i.View,{"className":"header-container"},l.default.createElement(i.View,null,l.default.createElement(s.AtIcon,{"value":"chevron-left","size":"24","color":"#FFFFFF","onClick":this.back})),l.default.createElement(i.View,{"className":"title"},this.props.title),l.default.createElement(i.View,null," "))}}]),NavHeader}();t.default=c},"173":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.updateTeamMap=void 0;var n=_interopRequireDefault(a(6)),r=(_interopRequireDefault(a(0)),a(157)),o=a(34);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}t.updateTeamMap=function updateTeamMap(e){var t={};return Object.keys(e).sort(r.naturalSort).forEach(function(a){t[a]=e[a]}),n.default.setStorageSync("teams",t),{"type":o.UPDATE_TEAM_MAP,"data":t}}},"178":function(e,t,a){},"179":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var n,r=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),o=a(6),l=_interopRequireDefault(o),i=_interopRequireDefault(a(0)),s=a(31),c=a(158),u=a(32);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}a(178),t.default=(0,u.connect)(function(e){return{"staff":e.staff}})(n=function(e){function JobCard(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,JobCard);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(JobCard.__proto__||Object.getPrototypeOf(JobCard)).call(this,e));return t.openWorkerPicking=function(){t.setState({"workerPicking":!0})},t.handleTagClick=function(e){var a=JSON.parse(JSON.stringify(t.props.jobData)),n=new Set(a.workers);e.active?n.delete(e.name):n.add(e.name),a.workers=[].concat(_toConsumableArray(n)),t.props.onJobChange({"jobName":t.props.jobName,"jobData":a})},t.handleJobNameInput=function(e){var a=e.detail.value;t.props.onJobChange({"oldName":t.props.jobName,"jobName":a,"jobData":t.props.jobData})},t.handleJobNumInput=function(e){var a=JSON.parse(JSON.stringify(t.props.jobData));a.num=e,t.props.onJobChange({"jobName":t.props.jobName,"jobData":a})},t.handleJobRestChange=function(e){var a=!e.detail.value,n=JSON.parse(JSON.stringify(t.props.jobData));n.rest=a,t.props.onJobChange({"jobName":t.props.jobName,"jobData":n})},t.delete=function(){l.default.showModal({"title":"操作不可逆","content":"确定要删除该岗位吗？","success":function success(e){e.confirm&&t.props.onJobChange({"deleteKey":t.props.jobName})}})},t.openCheatSelector=function(e){e.stopPropagation();var a=t.state.cheatClickCount;a>7?t.setState({"cheatClickCount":0,"cheatWorkerPicking":!0}):t.setState({"cheatClickCount":a+1,"cheatWorkerPicking":!1})},t.handleCheatTagClick=function(e){var a=JSON.parse(JSON.stringify(t.props.jobData)),n=new Set(a.cheatWorkers||[]);e.active?n.delete(e.name):n.add(e.name),a.cheatWorkers=[].concat(_toConsumableArray(n)),t.props.onJobChange({"jobName":t.props.jobName,"jobData":a})},t.handlePickingClose=function(){t.setState({"workerPicking":!1})},t.handleCheatClose=function(){t.setState({"cheatWorkerPicking":!1})},t.state={"workerPicking":!1,"cheatWorkerPicking":!1,"cheatClickCount":0},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(JobCard,o.Component),r(JobCard,[{"key":"render","value":function render(){var e=this,t=this.props.jobName,a=this.props.jobData||{},n=a.workers||[],r=a.cheatWorkers||[],o=n.map(function(e){return i.default.createElement(s.Text,{"className":"worker-card","key":e,"name":e},e)}),l=this.props.staff?this.props.staff.staffMap:{},u=Object.keys(l).map(function(t){return i.default.createElement(s.View,{"className":"tag","key":t},i.default.createElement(c.AtTag,{"className":"tag","name":t,"active":n.includes(t),"onClick":e.handleTagClick.bind(e)},t))}),f=Object.keys(l).map(function(t){return i.default.createElement(s.View,{"className":"tag","key":t},i.default.createElement(c.AtTag,{"className":"tag","name":t,"active":r.includes(t),"onClick":e.handleCheatTagClick.bind(e)},t))});return i.default.createElement(s.View,{"className":"card-container"},i.default.createElement(s.View,{"className":"card-header"},i.default.createElement(s.View,{"className":"operator-btn","onClick":this.delete},i.default.createElement(c.AtIcon,{"value":"subtract-circle","size":"24","color":"#ed4014"}))),i.default.createElement(s.View,{"className":"job-item"},i.default.createElement(s.Text,{"className":"title"},"职位名称"),i.default.createElement(s.Input,{"className":"item-input","name":"jobName","value":t,"placeholder":"请输入职位名称","onBlur":this.handleJobNameInput})),i.default.createElement(s.View,{"className":"job-item"},i.default.createElement(s.Text,{"className":"title"},"职位人数"),i.default.createElement(c.AtInputNumber,{"min":0,"step":1,"value":a.num,"onChange":this.handleJobNumInput})),i.default.createElement(s.View,{"className":"job-item"},i.default.createElement(s.Text,{"className":"title"},"职位参与分配"),i.default.createElement(s.Switch,{"checked":!a.rest,"onChange":this.handleJobRestChange})),i.default.createElement(s.View,{"className":"job-item","onClick":this.openWorkerPicking},i.default.createElement(s.Text,{"className":"title"},"指定人员"),i.default.createElement(s.View,null,o)),i.default.createElement(c.AtFloatLayout,{"isOpened":this.state.workerPicking,"title":"%u9009%u62E9%u6307%u5B9A%u4EBA%u5458","onClose":this.handlePickingClose},i.default.createElement(s.View,null,u)),i.default.createElement(c.AtFloatLayout,{"isOpened":this.state.cheatWorkerPicking,"title":"%u79D8%u5BC6%u9009%u62E9%u6307%u5B9A%u4EBA%u5458","onClose":this.handleCheatClose},i.default.createElement(s.View,null,f)))}}]),JobCard}())||n},"238":function(e,t,a){}}]);